performance.mark=performance.mark||(()=>{});class Router{constructor(){this._bindHandlers(),this._hostname=location.host,document.addEventListener('click',this._onLinkClick),performance.mark('router.hijack'),window.addEventListener('popstate',this._onPopState),this._globalSpinner=importPolyfill(`${_wordpressConfig.templateUrl}/dist/scripts/pwa/pwp-spinner.js`).then((a)=>a.globalSpinner),this._transitionAnimator=importPolyfill(`${_wordpressConfig.templateUrl}/dist/scripts/pwa/transition-animator.js`).then((a)=>a.default)}_bindHandlers(){this._onLinkClick=this._onLinkClick.bind(this),this._onPopState=this._onPopState.bind(this)}_onPopState(a){this.navigate(location.href,a.state.scrollTop,!1)}async _onLinkClick(a){if('A'===a.target.tagName){const b=new URL(a.target.href);return b.host===this._hostname?b.pathname.startsWith('/wp-admin')?void(document.location.href=b):void(a.preventDefault(),this.navigate(b.toString()).catch((a)=>console.error(a.stack))):void 0}}static get TRANSITION_DURATION(){return'0.3s'}async _animateOut(a){return a.style.transition=`opacity ${Router.TRANSITION_DURATION} linear`,a.style.opacity='0',transitionEndPromise(a)}async _animateIn(a){a.style.opacity='0',await requestAnimationFramePromise(),await requestAnimationFramePromise(),a.style.transition=`opacity ${Router.TRANSITION_DURATION} linear`,a.style.opacity='1',await transitionEndPromise(a)}_loadFragment(a){const b=document.createElement('pwp-view');return b.fragmentURL=a,b}async _animateHeader(a){const b=document.querySelector('header.hero').classList.contains('single');if(b===a)return()=>{};const c=await this._transitionAnimator;return a?c.toSingle():c.toFull()}async navigate(a,b=0,c=!0){history.scrollRestoration='manual',c&&(history.replaceState({scrollTop:document.scrollingElement.scrollTop},''),history.pushState({scrollTop:b},'',a));const d=a!==_wordpressConfig.baseUrl,e=document.querySelector('pwp-view'),f=this._animateOut(e),g=this._animateHeader(d),h=this._loadFragment(a),i=(await Promise.all([f,g]))[1],j=await this._globalSpinner;'timeout'===(await Promise.race([h.ready,timeoutPromise(500)]))&&j.ready.then(()=>{j.show()}),await h.ready,j.ready.then(()=>j.hide()),e.parentNode.replaceChild(h,e),document.scrollingElement.scrollTop=b,history.scrollRestoration='auto',await Promise.all([this._animateIn(h),i()]),_pubsubhub.dispatch('navigation',{address:a})}}function transitionEndPromise(a){return new Promise((b)=>{a.addEventListener('transitionend',function c(){a.removeEventListener('transitionend',c),b()})})}function requestAnimationFramePromise(){return new Promise((a)=>requestAnimationFrame(a))}function timeoutPromise(a,b='timeout'){return new Promise((c)=>setTimeout(()=>c(b),a))}const instance=new Router;export{Router,instance};